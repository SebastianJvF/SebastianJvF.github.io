<!doctype html>
<html>
<head>

	<title>Web app for rapid prototyping of interactive smartphone cases</title>
	
	<meta charset="utf-8">
	<link rel="stylesheet" type="text/css" href="css/layout.css"  media="all">
	
	<script src="js/fabric/fabric.js" type="text/javascript"></script>
	<script src="js/jquery-1.11.3.js" type="text/javascript"></script>
	
	<script type="text/javascript">
	/** MENU **/
	/* Menu toggles, Errors */
	$(document).ready(function () {
		/* Hide all option panels */
		$("#info-message").hide();
		$("nav div.options").hide();   
	  
	  	/* Change all the description divs into links */
		$("nav div.description").each(function () {
			var contentDescription = $(this).text()
			$(this).replaceWith('<a href="" title="Click to view the sub menu" class="description">' + contentDescription + '<\/a>') ;
		}); 
		
		/* Change the onclick function of the created links*/
		$("nav a.description").click( function () {
				
			/* If the menue is open, close it; Remark: next takes the next element of the same parent of the given element */
			if ($(this).next("div.options:visible").length != 0) {
				$(this).next("div.options").slideUp("normal");
			} else { /* Otherwise open it */
				/* Close all other menues */
				$("nav div.options").slideUp("normal");
				/* Open the next div.options we can find */
				$(this).next("div.options").slideDown("normal");
			}

			/* So that the browser does not try to open the link */
		    return false;
		});
	});
	
	/* Add drag and drop */
	/* Dragend - event $(document).bind('dragend', function(){ console.log("Dragend"); }); */ 
	/* Dragging workaround: set variable to true when clicked on link and check on mouse up */
	function createDraggableObject(fabricObject, buttonName) {
		var draggingStarted = false;
		
		/* Create a deep copy of the object to be able to add multiple elements */
		var deepCopy =  $.extend({}, fabricObject);
		
		$('#' + buttonName).mousedown(function() {
			draggingStarted = true;
			
			/* Change mouse cursor while dragging */
			$("nav").css('cursor', 'copy');
			$("div").css('cursor', 'copy');
			$("a").css('cursor', 'copy');
			canvas.defaultCursor = 'copy';
			
			$("#fire-dragend").mouseup(function(e) {
				if(draggingStarted == true) {
					console.log("Mouseup");
					draggingStarted = false;
					
					/* Change mouse cursor back as we're done dropping */
					$("nav").css('cursor', 'auto');
					$("div").css('cursor', 'auto');
					$("a").css('cursor', 'auto');
					canvas.defaultCursor = 'auto';
					
					/* Get mouse position on canvas */
					var offset = $("#fire-dragend").offset();
					var mouseCoordinates = {'x': e.pageX-offset.left, 'y': e.pageY-offset.top};
					
					/* Add object */	
					canvas.add(deepCopy);
					showMessage("Added button", showMessageBlue);
					
					/* Set coordinates */
					deepCopy.setTop(mouseCoordinates.y);
					deepCopy.setLeft(mouseCoordinates.x);
					
					/* Let element be further moved */
					deepCopy.setCoords();
					canvas.renderAll();
					
					/* Create a new deep copy to empty the old one */
					deepCopy =  $.extend({}, fabricObject);
				}
			});
			
			/* To end mousedown event right afterwards */
			return false;
		});
	}
	
	/* INFORMATION MESSAGES */
	var showMessageRed = '#FF6060';
	var showMessageBlue = '#6088FF';
	
	function showMessage(message, backgroundColor) {
		$("#info-message").html(message);
		$("#info-message").css("background-color", backgroundColor);
		$("#info-message").show().delay(5000).fadeOut();
		$("#info-message").slideUp("normal");
	}
	
	/** APPLICATION **/
	/* Variables */
	var phoneModel;
	
	/* Phone model */
	/* Make the user choose a phone model (disabled), show message */
	$(document).ready(function() {
		// $('#canvas').hide();
		$('#phone-model').change(function () {
		    if($(this).val() != '') {
		    	phoneModel = $(this).val();
		    	showMessage('Phone model chosen:<br>' +  $("#phone-model option:selected").text(), showMessageBlue);
		    	// $('#canvas').show();
		    } else {
		    	// $('#canvas').hide();
				phoneModel = '';
				showMessage('Please choose a phone model!', showMessageRed);
		    }
		})
	});
	</script>

</head>
<body>
	<div id="info-message">
	Please activate Javascript to use this application.
	</div>

	<div id="wrap">
		<nav>
			<div class="information">
			Please click on the menu headers below
			to view available configuration options.
			</div>
			
			<h1>Phone model</h1>
			<div class="description">Choose one of the available phone models below</div>
			<div class="options">
				<form id="application">
				<select id="phone-model">
				<option value="">Please choose...</option>
				<option value="iphone-5">iPhone 5</option>
				</select>
				</form>
			</div>	
			
			<h1>Push and rocker buttons</h1>
			<div class="description">Buttons that spring back to their usual, unpushed state</div>
			<div class="options">
				<ul>
				<li><a href="#" id="testbutton"><span></span>Hello World</a></li>
				<li></li>
				</ul>
				<span class="clear"></span>
			</div>
			
			<!--
			<h1>Knobs</h1>
			<div class="description">Rotary controls that can be turned to indicate one of the available state positions</div>
			<div class="options">Options panel</div>
			-->
			
			<h1>Sliders</h1>
			<div class="description">Control element to set a value by moving an indicator</div>
			<div class="options">Options panel</div>
		</nav>
		
		<div id="two-d-preview">
			<div class="information">
			This is a <span class="bold">2D representation</span> of the phone case.<br>
			Please drag controls from the menu onto the panel.
			</div>
	    	<div id="fire-dragend">
	    	<canvas id="twodpanel" width="570" height="500"></canvas>
	    	</div>
	    </div>
	    
	    <script>
		var canvas = new fabric.Canvas('twodpanel');
		var controlColor = '#000000';	
			
		/** 2D PHONE MODEL **/
		var modelStrokeWidth = 2;
		var modelColor = '#ffffff';
		var modelStrokeColor = '#c3bfbf';
		
		var middleRect = new fabric.Rect({
				top : 110,
				left : 185,
				width : 200,
				height : 280,
				fill : modelColor,
				strokeWidth : modelStrokeWidth,
				stroke: modelStrokeColor
		});
		
		var leftRect = new fabric.Rect({
				top : 110,
				left : 115,
				width : 50,
				height : 280,
				fill : modelColor,
				strokeWidth : modelStrokeWidth,
				stroke: modelStrokeColor
		});
		
		var rightRect = new fabric.Rect({
				top : 110,
				left : 405,
				width : 50,
				height : 280,
				fill : modelColor,
				strokeWidth : modelStrokeWidth,
				stroke: modelStrokeColor
		});
		
		var topRect = new fabric.Rect({
				top : 40,
				left : 185,
				width : 200,
				height : 50,
				fill : modelColor,
				strokeWidth : modelStrokeWidth,
				stroke: modelStrokeColor
		});
		
		var bottomRect = new fabric.Rect({
				top : 410,
				left : 185,
				width : 200,
				height : 50,
				fill : modelColor,
				strokeWidth : modelStrokeWidth,
				stroke: modelStrokeColor
		});
	
		canvas.add(middleRect);
		canvas.add(leftRect);
		canvas.add(rightRect);
		canvas.add(topRect);
		canvas.add(bottomRect);
		
		/* Make mock-up unselectable */
		canvas.item(0).selectable = false;
		canvas.item(1).selectable = false;
		canvas.item(2).selectable = false;
		canvas.item(3).selectable = false;
		canvas.item(4).selectable = false;		
		
		/** Add Drag and Drop Options **/
		$(document).ready(function() {
		                  
		    var text = new fabric.Text('Hello world!', { 
		    		left: 0,
		            top : 0,
		            fontSize: 30,
		            fontFamily: 'Arial',
		            fill: 'black',
		            textAlign: 'left',
		            hasControls: true,
		            lockUniScaling: true,
		            borderColor: controlColor,
		            cornerColor: controlColor
		    });
		    
		    createDraggableObject(text, 'testbutton');		    
		});
		
		/* Set control colours */
		
	    </script>
		
		<div id="three-d-panel">
			<div class="information">This is a <span class="bold">3D preview</span> of the case.<br> Turn it by dragging around.</div>
			<div id="three-d-preview"></div>
			<a href="#" title="Download 3D model(s)">Download 3D model(s)</a>
		</div>
		
		<span class="clear"></span>
	</div>

</body>
</html>